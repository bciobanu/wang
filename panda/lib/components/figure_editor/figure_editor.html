<div class="centered" *ngIf="!hasHighlightedFigure">
    <em>No figure selected. Select a figure from the list to view & edit its code here.</em>
</div>
<div class="centered" *ngIf="hasHighlightedFigure && !isFigureLoaded">
    <material-spinner></material-spinner>
</div>
<div class="editor-container" *ngIf="hasHighlightedFigure && isFigureLoaded">
    <h2>
        <template [ngIf]="!editingFigureName">
            {{figure.name}}
            <material-fab style="margin-left: 10px;" mini (trigger)="setEditingFigureName()">
                <material-icon icon="edit"></material-icon>
            </material-fab>
        </template>
        <template [ngIf]="editingFigureName">
            <input type="text" #nameInput [value]="figureNameDirty" (input)="figureNameDirty = nameInput.value"
                   (keyup.enter)="commitFigureName()"/>
            <material-fab *ngIf="!committingFigureNameEdit" style="margin-left: 10px;" mini
                          (trigger)="commitFigureName()">
                <material-icon icon="done"></material-icon>
            </material-fab>
            <material-fab *ngIf="!committingFigureNameEdit" style="margin-left: 10px;" mini
                          (trigger)="cancelEditingFigureName()">
                <material-icon icon="clear"></material-icon>
            </material-fab>
            <material-spinner *ngIf="committingFigureNameEdit" style="margin-left: 20px;"></material-spinner>
        </template>
        <material-button style="float: right; position: relative"
                         [disabled]="compilingFigure"
                         (trigger)="compileFigure()">
            <div class="white-button-overlay" [style.opacity]="compilingFigure ? '0.4' : '0'">
                <material-spinner *ngIf="compilingFigure" style="margin: 0 auto;"></material-spinner>
            </div>
            <material-icon icon="settings"></material-icon>
            Compile
        </material-button>
        <material-button style="float: right; position: relative"
                         [disabled]="!isCurrentFigureDirty || committingFigureCode"
                         (trigger)="commitFigureCode()">
            <div class="white-button-overlay" [style.opacity]="committingFigureCode ? '0.4' : '0'">
                <material-spinner *ngIf="committingFigureCode" style="margin: 0 auto;"></material-spinner>
            </div>
            <material-icon icon="save"></material-icon>
            Save
        </material-button>
    </h2>
    <textarea #codeEditor style="font-family: monospace; resize: none; height: 320px;"
              (input)="setCurrentFigureDirtyCode(codeEditor.value)">
        {{currentFigureDirtyCode}}
    </textarea>
    <div *ngIf="isCurrentFigureCompiled" style="flex: 1; margin-top: 20px;">
        <h3 *ngIf="currentFigureCompilationResult.isSuccessful">Tikz code:</h3>
        <h3 *ngIf="!currentFigureCompilationResult.isSuccessful">Tikz compiled with errors:</h3>
        <div class="compilation-result-container">
            <div *ngFor="let error of currentFigureCompilationResult.errors">
                <span style="color: red;">Error</span> (code={{error.code}} {{error.codeName}}): {{error.description}}
            </div>
            <pre *ngIf="currentFigureCompilationResult.isSuccessful">{{currentFigureCompilationResult.tikzCode}}</pre>
        </div>
    </div>
</div>
