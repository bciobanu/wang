<div class="centered" *ngIf="!isFigureLoaded">
    <material-spinner></material-spinner>
</div>
<div class="editor-container" *ngIf="isFigureLoaded">
    <h2>
        <template [ngIf]="!editingFigureName">
            {{figure.name}}
            <material-fab style="margin-left: 10px;" mini (trigger)="setEditingFigureName()">
                <material-icon icon="edit"></material-icon>
            </material-fab>
        </template>
        <template [ngIf]="editingFigureName">
            <input type="text" #nameInput [value]="figure.dirtyName" (input)="setFigureDirtyName(nameInput.value)"
                   (keyup.enter)="commitFigureName()"/>
            <material-fab *ngIf="!committingFigureNameEdit" style="margin-left: 10px;" mini
                          (trigger)="commitFigureName()">
                <material-icon icon="done"></material-icon>
            </material-fab>
            <material-fab *ngIf="!committingFigureNameEdit" style="margin-left: 10px;" mini
                          (trigger)="cancelEditingFigureName()">
                <material-icon icon="clear"></material-icon>
            </material-fab>
            <material-spinner *ngIf="committingFigureNameEdit" style="margin-left: 20px;"></material-spinner>
        </template>
        <material-button style="float: right; position: relative"
                         [disabled]="compilingFigure"
                         (trigger)="compileFigure()">
            <div class="white-button-overlay" [style.opacity]="compilingFigure ? '0.4' : '0'">
                <material-spinner *ngIf="compilingFigure" style="margin: 0 auto;"></material-spinner>
            </div>
            <material-icon icon="settings"></material-icon>
            Compile
        </material-button>
        <material-button style="float: right; position: relative"
                         [disabled]="!figure.hasDirtyCode || committingFigureCode"
                         (trigger)="commitFigureCode()">
            <div class="white-button-overlay" [style.opacity]="committingFigureCode ? '0.4' : '0'">
                <material-spinner *ngIf="committingFigureCode" style="margin: 0 auto;"></material-spinner>
            </div>
            <material-icon icon="save"></material-icon>
            Save
        </material-button>
    </h2>
    <textarea #codeEditor style="font-family: monospace; resize: none; height: 320px;"
              (input)="setFigureDirtyCode(codeEditor.value)" [value]="figure.dirtyCode">
    </textarea>
    <div *ngIf="figure.hasCompilationResult" style="flex: 1; margin-top: 20px;">
        <h3 *ngIf="figure.compilationResult.isSuccessful">Tikz code:</h3>
        <h3 *ngIf="!figure.compilationResult.isSuccessful">Tikz compiled with errors:</h3>
        <div class="compilation-result-container">
            <div *ngFor="let error of figure.compilationResult.errors">
                <span style="color: red;">Error</span> (code={{error.code}}): {{error.description}}
            </div>
            <pre *ngIf="figure.compilationResult.isSuccessful">{{figure.compilationResult.tikzCode}}</pre>
        </div>
    </div>
</div>
